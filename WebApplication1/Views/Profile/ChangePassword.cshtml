@model WebApplication1.ViewModels.ChangePasswordViewModel
@{
    ViewData["Title"] = "Change Password";
    ViewData["PageTitle"] = "Change Password";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@section SidebarMenu {
    @if (User.IsInRole("Student"))
    {
        @await Html.PartialAsync("~/Areas/Student/Views/Shared/_StudentSidebar.cshtml")
    }
    else if (User.IsInRole("Lecturer"))
    {
        @await Html.PartialAsync("~/Areas/Lecturer/Views/Shared/_LecturerSidebar.cshtml")
    }
    else if (User.IsInRole("Admin"))
    {
        @await Html.PartialAsync("~/Areas/Admin/Views/Shared/_AdminSidebar.cshtml")
    }
}

@section Styles {
    <link rel="stylesheet" href="~/css/profile-changepassword.css" />
}

<div class="password-container">
    
    <div class="password-card">
        <form asp-action="ChangePassword" method="post">
            @if (!ViewData.ModelState.IsValid)
            {
                <div asp-validation-summary="All" class="alert alert-danger" role="alert"></div>
            }
            
            <div class="form-group">
                <label class="form-label">Current Password</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-lock"></i>
                    </span>
                    <input asp-for="CurrentPassword" type="password" class="form-control" placeholder="Enter current password" id="currentPassword" />
                    <button type="button" class="toggle-password" onclick="togglePassword('currentPassword')">
                        <i class="bi bi-eye" id="currentPassword-icon"></i>
                    </button>
                </div>
                <span asp-validation-for="CurrentPassword" class="text-danger small"></span>
            </div>
            
            <div class="form-group">
                <label class="form-label">New Password</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-key"></i>
                    </span>
                    <input asp-for="NewPassword" type="password" class="form-control" placeholder="Enter new password" id="newPassword" />
                    <button type="button" class="toggle-password" onclick="togglePassword('newPassword')">
                        <i class="bi bi-eye" id="newPassword-icon"></i>
                    </button>
                </div>
                <span asp-validation-for="NewPassword" class="text-danger small"></span>
            </div>
            
            <div class="form-group">
                <label class="form-label">Confirm New Password</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-shield-check"></i>
                    </span>
                    <input asp-for="ConfirmPassword" type="password" class="form-control" placeholder="Confirm new password" id="confirmPassword" />
                    <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword')">
                        <i class="bi bi-eye" id="confirmPassword-icon"></i>
                    </button>
                </div>
                <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
            </div>
            
            <div class="password-requirements">
                <h6><i class="bi bi-info-circle me-2"></i>Password Requirements</h6>
                <ul>
                    <li>
                        <i class="bi bi-check-circle-fill"></i>
                        <span>At least 6 characters long</span>
                    </li>
                    <li>
                        <i class="bi bi-check-circle-fill"></i>
                        <span>Must not match current password</span>
                    </li>
                    <li>
                        <i class="bi bi-check-circle-fill"></i>
                        <span>Confirmation must match new password</span>
                    </li>
                </ul>
            </div>
            
            <div class="action-buttons">
                <button type="submit" class="btn btn-primary btn-update">
                    <i class="bi bi-shield-lock me-2"></i>
                    Update Password
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-update">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(inputId + '-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        }
    </script>
}
