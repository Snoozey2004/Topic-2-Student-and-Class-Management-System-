# ?? Enrollment System Documentation

## T?ng quan

H? th?ng ??ng ký h?c ph?n t? ??ng (Auto-Enrollment) cho phép sinh viên ??ng ký môn h?c và ???c duy?t ngay l?p t?c, t??ng t? nh? các h? th?ng ??ng ký c?a các tr??ng ??i h?c l?n.

---

## ?? Lu?ng ho?t ??ng chính

### 1. Sinh viên ??ng ký môn h?c

```
???????????????????????????????????????????????????????????????????
?                    STUDENT ENROLLMENT FLOW                       ?
???????????????????????????????????????????????????????????????????
?                                                                  ?
?  Student clicks "Register"                                       ?
?           ?                                                      ?
?           ?                                                      ?
?  ???????????????????????                                        ?
?  ?   CanEnroll Check   ?                                        ?
?  ???????????????????????                                        ?
?           ?                                                      ?
?     ?????????????                                               ?
?     ?           ?                                                ?
?   PASS        FAIL ??????? Return Error Message                 ?
?     ?                                                            ?
?     ?                                                            ?
?  ???????????????????????                                        ?
?  ? Create Enrollment   ?                                        ?
?  ? Status = Approved   ?                                        ?
?  ???????????????????????                                        ?
?           ?                                                      ?
?           ?                                                      ?
?  ???????????????????????                                        ?
?  ? courseClass.        ?                                        ?
?  ? CurrentStudents++   ?????? S? ch? tr?ng gi?m ?i 1           ?
?  ???????????????????????                                        ?
?           ?                                                      ?
?           ?                                                      ?
?  ???????????????????????                                        ?
?  ? Create Grade Record ?????? T?o b?n ghi ?i?m (ch?a có ?i?m)  ?
?  ???????????????????????                                        ?
?           ?                                                      ?
?           ?                                                      ?
?  ???????????????????????                                        ?
?  ? Send Notification   ?????? G?i thông báo cho sinh viên      ?
?  ???????????????????????                                        ?
?           ?                                                      ?
?           ?                                                      ?
?      ? SUCCESS                                                  ?
?  - Môn xu?t hi?n trong "My Registered Courses"                  ?
?  - Môn xu?t hi?n trong "My Schedule"                            ?
?  - Môn xu?t hi?n trong "My Grades" (ch? nh?p ?i?m)             ?
?                                                                  ?
???????????????????????????????????????????????????????????????????
```

### 2. Sinh viên h?y ??ng ký (Drop)

```
???????????????????????????????????????????????????????????????????
?                      STUDENT DROP FLOW                           ?
???????????????????????????????????????????????????????????????????
?                                                                  ?
?  Student clicks "Drop"                                           ?
?           ?                                                      ?
?           ?                                                      ?
?  ???????????????????????                                        ?
?  ? enrollment.Status   ?                                        ?
?  ? = Dropped           ?                                        ?
?  ???????????????????????                                        ?
?           ?                                                      ?
?           ?                                                      ?
?  ???????????????????????                                        ?
?  ? courseClass.        ?                                        ?
?  ? CurrentStudents--   ?????? S? ch? tr?ng t?ng lên 1          ?
?  ???????????????????????                                        ?
?           ?                                                      ?
?           ?                                                      ?
?  ???????????????????????                                        ?
?  ? Remove Grade Record ?????? Xóa b?n ghi ?i?m                  ?
?  ???????????????????????                                        ?
?           ?                                                      ?
?           ?                                                      ?
?      ? SUCCESS                                                  ?
?  - Môn bi?n m?t kh?i "My Registered Courses"                    ?
?  - Môn bi?n m?t kh?i "My Schedule"                              ?
?  - Môn bi?n m?t kh?i "My Grades"                                ?
?                                                                  ?
???????????????????????????????????????????????????????????????????
```

---

## ? Các ?i?u ki?n ki?m tra khi ??ng ký (CanEnroll)

Hàm `CanEnroll()` trong `EnrollmentService.cs` ki?m tra **7 ?i?u ki?n** tr??c khi cho phép ??ng ký:

| # | Ki?m tra | Mô t? | Error Message |
|---|----------|-------|---------------|
| 1 | **Already enrolled** | SV ?ã ??ng ký l?p này ch?a | "Already enrolled in this class" |
| 2 | **Class exists** | L?p h?c có t?n t?i không | "Class not found" |
| 3 | **Capacity** | L?p còn ch? tr?ng không | "Class is full" |
| 4 | **Class status** | L?p có ?ang m? ??ng ký không | "Class is not open for registration" |
| 5 | **Same subject** | SV ?ã ??ng ký môn này (l?p khác) trong HK ch?a | "Already enrolled in this subject" |
| 6 | **Schedule conflict** ? | L?ch h?c có trùng v?i môn ?ã ??ng ký không | "Schedule conflict with {ClassCode}" |
| 7 | **Prerequisites** | SV ?ã hoàn thành môn tiên quy?t ch?a | "Prerequisites not met: {SubjectCodes}" |

### ?? Chi ti?t ki?m tra trùng l?ch (Schedule Conflict)

```csharp
// Ki?m tra trùng l?ch d?a trên:
// 1. Cùng ngày trong tu?n (DayOfWeek)
// 2. Cùng ti?t h?c (Period) HO?C th?i gian ch?ng chéo (TimeOverlap)

// Ví d? trùng l?ch:
// - Môn A: Monday, Period 1-3, 07:00-09:30
// - Môn B: Monday, Period 1-3, 07:00-09:30  ? CONFLICT!

// Ví d? không trùng:
// - Môn A: Monday, Period 1-3, 07:00-09:30
// - Môn B: Monday, Period 4-6, 09:45-12:15  ? OK
```

---

## ?? C?p nh?t s? l??ng sinh viên (CurrentStudents)

### Khi nào t?ng?
| Hành ??ng | CurrentStudents |
|-----------|-----------------|
| Student ??ng ký (auto-approve) | `++` |
| Admin approve enrollment pending | `++` |

### Khi nào gi?m?
| Hành ??ng | CurrentStudents |
|-----------|-----------------|
| Student drop (n?u ?ã approved) | `--` |
| Admin delete enrollment (n?u ?ã approved) | `--` |

### Công th?c tính Available slots
```
Available = MaxStudents - CurrentStudents
```

---

## ?? Files liên quan

| File | Mô t? |
|------|-------|
| `Services/EnrollmentService.cs` | Logic chính c?a enrollment |
| `Areas/Student/Controllers/EnrollmentController.cs` | Controller x? lý request |
| `Areas/Student/Views/Enrollment/Index.cshtml` | Giao di?n ??ng ký |
| `Data/FakeDatabase.cs` | Database gi? l?p |
| `ViewModels/AvailableCourseViewModel.cs` | ViewModel cho danh sách môn |

---

## ?? Test Workflow

### Test Case 1: ??ng ký thành công
1. Login: `phamvand@student.edu.vn` / `student123`
2. Vào **Course Registration**
3. Ch?n môn ch?a ??ng ký (ví d?: BA001.01)
4. Click **Register**
5. ? Ki?m tra:
   - S? "Available" gi?m ?i 1
   - Môn xu?t hi?n trong "My Registered Courses" v?i status "Approved"
   - Vào **My Schedule** th?y l?ch h?c
   - Vào **My Grades** th?y môn (ch?a có ?i?m)

### Test Case 2: Trùng l?ch
1. Login: `phamvand@student.edu.vn` / `student123`
2. Ki?m tra ?ã ??ng ký IT001.01 (Monday, Period 1-3)
3. Th? ??ng ký môn khác cùng l?ch
4. ? Ki?m tra: Hi?n th? l?i "Schedule conflict with IT001.01"

### Test Case 3: Drop môn
1. Login: `phamvand@student.edu.vn` / `student123`
2. Vào **Course Registration**
3. Click **Drop** trên môn ?ã ??ng ký
4. ? Ki?m tra:
   - S? "Available" t?ng lên 1
   - Môn bi?n m?t kh?i schedule và grades

---

## ?? API Reference

### EnrollmentService Methods

```csharp
// ??ng ký môn h?c
bool Enroll(int studentId, int courseClassId, bool autoApprove = true)

// Ki?m tra ?i?u ki?n ??ng ký
bool CanEnroll(int studentId, int courseClassId, out string message)

// H?y ??ng ký
bool Drop(int enrollmentId)

// L?y danh sách môn có th? ??ng ký
List<AvailableCourseViewModel> GetAvailableCoursesForStudent(int studentId)
```

---

## ?? Notes

1. **Auto-approve**: M?c ??nh `autoApprove = true`, t?c là ??ng ký thành công ngay l?p t?c
2. **FakeDatabase**: D? li?u l?u trong memory, restart app s? m?t
3. **Schedule links**: Schedule ???c link qua `CourseClassId`, khi enroll xong t? ??ng có schedule
4. **Grade record**: T?o ngay khi enroll, ban ??u ch?a có ?i?m

---

## ?? Future Improvements

- [ ] Add enrollment period validation (ch? cho ??ng ký trong th?i gian m?)
- [ ] Add credit limit per semester
- [ ] Add waitlist for full classes
- [ ] Add email notifications
- [ ] Persist data to real database

---

*Last updated: December 2024*
